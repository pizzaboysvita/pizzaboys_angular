<div class="row">
  <div class="col-sm-12">
    <app-card [body]="true">
      <div body
        class="row row-cols-xl-12 row-cols-md-5 row-cols-sm-3 row-cols-2 g-sm-3 g-2 media-library-sec ratio_landscape">
        <div class="input-box search-icon">
          <i class="ri-search-line"></i>
          <input class="search-box" type="search" placeholder="What are you looking for?" [(ngModel)]="searchText"
            name="search" (keyup)="searchTerm(searchText)"
            style="flex: 1; border: none; outline: none; background: transparent;" />
        </div>

        <div class="w-100">
          <div class="mb-4 position-relative">
            <h5 class="mb-3 fw-bold">Categories</h5>
            <button class="scroll-btn start" (click)="scrollLeft()">‹</button>
            <button class="scroll-btn end" (click)="scrollRight()">›</button>

            <div #scrollContainer class="d-flex gap-3 pb-2 px-3" style="scroll-behavior: smooth; overflow: hidden;">
              @for (category of categoriesList; track category.category_id) {
              <div class="d-flex align-items-center px-3 py-2 bg-white shadow-sm rounded-4 flex-shrink-0"
                (click)="selectCategory(category)" [ngClass]="{
                                    'border-primary border-2': selectedCategory === category
                                }" style="min-width: 120px;">
                <img [src]="category.category_image" alt="{{ category.name }}"
                  style="width: 25px; height: 25px; border-radius: 50%;" class="me-3" />
                <div>
                  <div class="fw-semibold">{{ category.name }}</div>
                  <div class="text-muted small">
                    {{ category.dishes.length }} items
                  </div>
                </div>
              </div>
              }
            </div>
          </div>

          <div class="row gx-2 gy-0">
            @for (item of dishList; track item.dish_id) {
            <div class="col-md-3" style="margin-top: -15px !important;">
              <div class="card flex-row align-items-center p-2 shadow-sm h-100" style="height: 110px !important;cursor: pointer;"
                (click)="openIngredientsPopup(item)">
                <img [src]="item.dish_image" alt="{{ item.dish_name }}" class="img-thumbnail me-3"
                  style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;" />

                <div class="flex-grow-1">
                  <h6 class="mb-1">{{ item.dish_name }}</h6>
                  <div class="d-flex justify-content-between align-items-center mb-1">
                    <span class="fw-bold">${{ item.dish_price }}</span>
                  </div>
                  <div class="d-flex align-items-end gap-1 quantity-controls" style="justify-content: end;">
                    <button *ngIf="!item.quantity || item.quantity === 0" class="qty-btn"
                      (click)="addItem(item); $event.stopPropagation()">
                      +
                    </button>

                    <ng-container *ngIf="item.quantity as currentQuantity">
                      <ng-container *ngIf="currentQuantity > 0">
                        <!-- <button class="qty-btn" >
                          -
                        </button> -->
                        <!-- <span class="qty-count">{{ item.quantity }}</span> -->
                        <button class="qty-btn"  >
                          +
                        </button>
                      </ng-container>
                    </ng-container>
                  </div>
                </div>
              </div>
            </div>
            }
          </div>
        </div>
      </div>
    </app-card>
  </div>
</div>

@if (showPopup) {
<div class="modal fade show d-block modal-overlay" tabindex="-1" role="dialog" aria-labelledby="ingredientsModalLabel"
  aria-hidden="true">

@for(dishDetails of cartItems;track dishDetails){
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content" #modalContent>
      <div class="modal-header">
        <h4 class="modal-title w-100" id="ingredientsModalLabel">
          <span class="fw-bold fs-4">{{ dishDetails.display_name }}</span>
          <span class="float-end fw-bold fs-4">${{ totalPrice
            }}</span>
        </h4>
      </div>

      <div class="modal-body">
        <div class="accordion" id="accordionExample">
          @for (optSet of dishDetails.dish_option_set_array; track optSet; let i = $index) {
          <div class="accordion-item">
            <h2 class="accordion-header" [id]="'heading-' + i">
              <button class="accordion-button" type="button" data-bs-toggle="collapse"
                [attr.data-bs-target]="'#collapse-' + i" [attr.aria-controls]="'collapse-' + i"
                [class.collapsed]="i !== 0" [attr.aria-expanded]="i === 0 ? 'true' : 'false'">
                <strong>{{ optSet.dispaly_name }}</strong>
              </button>
            </h2>
            <div [id]="'collapse-' + i" class="accordion-collapse collapse" [class.show]="i === 0"
              [attr.aria-labelledby]="'heading-' + i" data-bs-parent="#accordionExample">
              <div class="accordion-body">
         @for (option of optSet.option_set_array; track option; let j = $index) {

                <div class="option-list-item d-flex justify-content-between align-items-center mb-2">
                  <span class="fw-normal option-name-text">{{option.name}}</span>
                  <div class="option-price-toggle-group d-flex align-items-center">
                    <!-- @if (baseOption.price > 0) { -->
                    <span class="price-display">+${{option.price}}</span>
                    <!-- } -->
                     <div >
        
   <input [type]="optSet.display_name === 'Base' ? 'radio' : 'checkbox'"
 id="checkbox-{{ j }}" class="form-check-input me-2" [checked]="option.selected"   [name]="'baseOptionGroup'"   (change)="updateItem('option',dishDetails, option )" 
                    />
                  <label for="checkbox-{{ j }}" class="form-check-label mb-0" style="font-size: 0.92rem;">
                  </label>

                      </div>
                  </div>
                </div>

              }








              </div>
            </div>
          </div>
          }
        </div>













        <div class="notes-section">
          <label class="form-label fw-semibold mb-1 option-section-title">
            Notes
          </label>
          <textarea class="form-control" [(ngModel)]="selectedItem.notes" placeholder="Add a note..."></textarea>
        </div>
      </div>

      <div class="modal-footer">
        <div class="input-group quantity-control">
          <button class="btn btn-outline-warning" (click)="updateItem('decrease',dishDetails,'')">
            −
          </button>
          <input type="text" class="form-control text-center quantity-input" [value]="dishDetails.quantity" readonly />
          <button class="btn btn-outline-warning"  (click)="updateItem('increase',dishDetails,'')">
            +
          </button>
          <button class="btn btn-outline-secondary ms-2">
            <i class="ri-file-copy-line"></i>
          </button>
          <button class="btn btn-outline-secondary">
            <i class="ri-price-tag-3-line"></i>
          </button>
          <button class="btn btn-warning text-white fw-bold px-4" (click)="addDish(dishDetails)">
            ADD DISH
          </button>
        </div>

      </div>
    </div>
  </div>
}
</div>
}