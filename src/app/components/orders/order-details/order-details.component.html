<div class="row">
  <div class="col-xl-8">
    <app-media (itemAdded)="addToCart($event)" (popupClosed)="onPopupClosed()"></app-media>
  </div>
  <div class="col-xl-4">


    <div class="card p-3 shadow-sm d-flex flex-column"
      style="border-radius: 8px; height: 90vh; overflow: hidden !important;">
      <!-- Header -->
      <!-- <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h6 class="fw-bold  mb-1">Order Details</h6> -->
      <!-- <div class="text-muted" style="font-size: 12px;">#ORD-3291</div> -->
      <!-- </div>
        <div class="maerail-btn-icons" (click)="orderList()">
          <span class="material-symbols-outlined" style="font-size: 18px;">more_vert</span>
        </div>
      </div> -->

      <!-- Dine In / Take Away / Delivery Buttons -->
      <div class="btn-group w-100 mb-3 order-type-toggle">
        <button type="button" class="toggle-btn" [class.active]="selected === 'dinein'"
          (click)="selected = 'dinein' ;openNewModelPopup()">
          {{orderForm.value.orderType}}
        </button>
        <button type="button" class="toggle-btn" [class.active]="selected === 'delivery'"
          (click)="selected = 'delivery'; openDeliveryPopup()">
          {{orderDueDetails}}
        </button>
      </div>
<div class="icon-row d-flex mb-3">
  <div class="icon-box"><i class="ri-file-line"></i></div>
  <div class="icon-box" (click)="openCustomerModal()"><i class="ri-user-line" ></i></div>
  <div class="icon-box"><i class="ri-price-tag-line"></i></div>
  <div class="icon-box"><i class="ri-hand"></i></div>
  <div class="icon-box"><i class="ri-shopping-cart-line"></i></div>
</div>

      <!-- Order Items List -->
      <div style="height: 400px; overflow-y: auto;overflow-x: hidden">
        <!-- <div class="checkout-detail p-0"> -->
        <ul>
          @for (item of totalCartDetails; track item) {
          @if(item.dish_type =='combo'){
          <li class="mb-3">
            <div class="horizontal-product-box">
              <div class="row align-items-start">
                <!-- Left: Image + Quantity -->
                <div class="col-3 text-center">
                  <img [src]="item.dish_image" alt="{{ item.dish_name }}" width="70" height="60" class="rounded"
                    style="object-fit: cover;">
                  <div class="like-box d-flex justify-content-center mt-2" style="width: 70px;">
                    <i class="ri-subtract-line" style="cursor: pointer;" (click)="decreaseModalQuantity(item)"></i>
                    <span>{{item.dish_quantity}}</span>
                    <i class="ri-add-line" style="cursor: pointer;" (click)="increaseModalQuantity(item)"></i>
                    <i class="ri-delete-bin-line text-danger" style="cursor: pointer;" (click)="removeItem(item)"></i>
                  </div>
                </div>

                <!-- Right: Dish Info -->
                <!-- Right: Dish Info -->
                <div class="col-9">
                  <!-- Dish Name and Price -->
                  <div class="d-flex justify-content-between">
                    <h6 class="mb-0" style="font-size: 14px;"><b>{{ item.dish_name }}</b></h6>
                    <h6 class="mb-0 fw-bold" style="font-size: 14px;">${{ item.item_total_price }}</h6>
                  </div>

                  <!-- Ingredients and their prices -->
                  <div *ngFor="let comboOpt of item.combo_selected_dishes" class="mt-1">
                    <!-- Combo option + dish name -->
                    <div style="font-size: 14px;">
                      <span style="text-decoration: underline; font-weight: 600;">
                        {{ comboOpt.combo_option_name }}
                      </span> ({{ comboOpt.combo_option_dish_name }})
                    </div>

                    <!-- Each option set -->
                    <div *ngFor="let option of comboOpt.combo_option_selected_array" class="ms-3">
                      <div style="font-size: 14px; font-weight: 500;">
                        {{ option.dish_opt_type }}
                      </div>

                      <!-- Selected options inside -->
                      <ul class="ms-4 mb-1" style="font-size: 14px; list-style-type: disc;">
                        <li *ngFor="let opt of option.choose_option">
                          {{ opt.name }} - ${{ opt.price }}
                        </li>
                      </ul>
                    </div>
                  </div>
                    <div class="d-flex align-items-center gap-3">
  <i class="ri-edit-2-line text-primary fs-5" style="cursor: pointer;" (click)="editItem(item)"></i>
  <i class="ri-delete-bin-line text-danger fs-5" style="cursor: pointer;" (click)="removeItems(item)"></i>
</div>
                </div>


              </div>
            </div>
          </li>
          }@else if (item.dish_type =='standard'){
          <li class="mb-3">
            <div class="horizontal-product-box">
              <div class="row align-items-start">
                <!-- Left: Image + Quantity -->
                <div class="col-3 text-center">
                  <img [src]="item.dish_image" alt="{{ item.dish_name }}" width="70" height="60" class="rounded"
                    style="object-fit: cover;">
                  <div class="like-box d-flex justify-content-center mt-2" style="width: 70px;">
                    <i class="ri-subtract-line" style="cursor: pointer;" (click)="decreaseModalQuantity(item)"></i>
                    <span>{{item.dish_quantity}}</span>
                    <i class="ri-add-line" style="cursor: pointer;" (click)="increaseModalQuantity(item)"></i>
                    <i class="ri-delete-bin-line text-danger" style="cursor: pointer;" (click)="removeItem(item)"></i>
                  </div>
                </div>

                <!-- Right: Dish Info -->
                <!-- Right: Dish Info -->
                <div class="col-9">
                  <!-- Dish Name and Price -->
                  <div class="d-flex justify-content-between">
                    <h6 class="mb-0" style="font-size: 14px;"><b>{{ item.dish_name }}</b></h6>
                    <h6 class="mb-0 fw-bold" style="font-size: 14px;">${{ item.item_total_price }}</h6>
                  </div>

                  <!-- Ingredients and their prices -->
                  <div *ngFor="let standedOpt of item.standed_option_selected_array" class="mt-1">
                    <!-- Combo option + dish name -->


                    <!-- Each option set -->
                    <!-- <div *ngFor="let option of standedOpt.combo_option_selected_array" class="ms-3"> -->
                    <div style="font-size: 14px; font-weight: 500;">
                      {{ standedOpt.dish_opt_type }}
                    </div>

                    <!-- Selected options inside -->
                    <ul class="ms-4 mb-1" style="font-size: 14px; list-style-type: disc;">
                      <li *ngFor="let opt of standedOpt.choose_option">
                        {{ opt.name }} <span *ngIf="opt.price"> - ${{ opt.price }}</span>
                      </li>
                    </ul>
                    <!-- </div> -->
                  </div>
                    <div class="d-flex align-items-center gap-3">
  <i class="ri-edit-2-line text-primary fs-5" style="cursor: pointer;" (click)="editItem(item)"></i>
  <i class="ri-delete-bin-line text-danger fs-5" style="cursor: pointer;" (click)="removeItems(item)"></i>
                </div>
      <!-- Selected options inside -->
      <ul class="ms-4 mb-1" style="font-size: 14px; list-style-type: disc;">
        <li *ngFor="let opt of standedOpt.choose_option">
          {{ opt.name }} <span *ngIf="opt.price"> - ${{ opt.price }}</span>
        </li>
      </ul>
    <!-- </div> -->
  </div>
</div>
                </div>

              </div>
            </div>
              
          </li>
          }
          }
        </ul>
        <!-- </div> -->


      </div>

      <!-- Summary -->
      <div class="pt-3">
        <div class="d-flex justify-content-between mb-1">
          <span class="text-muted">Subtotal</span>
          <span class="fw-semibold">${{ subtotal.toFixed(2) }}</span>
        </div>
        <div class="d-flex justify-content-between mb-2">
          <span class="text-muted">GST 10%</span>
          <span class="fw-semibold">${{ tax }}</span>
        </div>
        @if(orderForm.value.orderType =='delivery'){
        <div class="d-flex justify-content-between mb-2">
          <span class="text-muted">Delivery Fee</span>
          <span class="fw-semibold">${{ deliveryfee }}</span>
        </div>
        }
        <div class="d-flex justify-content-between fw-bold mb-3">
          <span>Total</span>
          <span>${{ total.toFixed(2) }}</span>
        </div>

        <button class="btn btn-primary w-100 fw-bold" style="border-radius: 10px; padding: 12px;"
          (click)="submitOrder()">
          Pay ${{ total.toFixed(2) }}
        </button>
      </div>
    </div>

  </div>
</div>


<!-- <div class="modal fade" tabindex="-1" role="dialog" [ngClass]="{ 'show d-block': showNewModelPopup }">
  <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
    <div class="modal-content"> -->
<div class="modal fade" tabindex="-1" role="dialog" [ngClass]="{ 'show d-block': showNewModelPopup }" style="  background: rgba(0,0,0,0.5);  /* <-- dim effect */
  z-index: 1040; ">
  <div class="modal-dialog modal-sm modal-dialog-centered " role="document">
    <div class="modal-content">
      <!-- Header -->
      <div class="modal-header">
        <h5 class="modal-title">Order Type</h5>
        <button type="button" class="btn-close" (click)="closeNewModelPopup()"></button>
      </div>

      <!-- Body -->
      <div class="modal-body">
        <form [formGroup]="orderForm">

          <!-- Order Type -->
          <div class="mb-3">
            <label class="form-label">Order Type</label>
            <select class="form-select" formControlName="orderType">
              <option value="pickup">Pick Up</option>
              <option value="delivery">Delivery</option>
            </select>
          </div>

          <!-- Delivery Address (shown only if Delivery selected) -->
          <div class="mb-3" *ngIf="orderForm.get('orderType')?.value === 'delivery'">
            <label class="form-label">Delivery Address</label>
            <input type="text" #addressInput class="form-control" (input)="getAddressAutocomplete()"
              placeholder="Search your address" formControlName="deliveryAddress">
          </div>

          <div class="mb-3" *ngIf="orderForm.get('deliveryAddress')?.value">
            <label class="form-label">Street Number</label>
            <input type="text" class="form-control" formControlName="streetNumber" placeholder="Enter street number" />
          </div>

          <div class="mb-3" *ngIf="orderForm.get('deliveryAddress')?.value">
            <label class="form-label">Unit Number</label>
            <input type="text" class="form-control" formControlName="unitNumber" placeholder="Enter unit number" />
          </div>

          <div class="mb-3" *ngIf="orderForm.get('deliveryAddress')?.value">
            <label class="form-label">Delivery Note</label>
            <input type="text" #addressInput class="form-control" formControlName="deliveryNote"
              placeholder="Enter delivery note" />
          </div>

          <!-- Submit -->
          <button type="button" class="btn fw-bold text-white" style="background:#f44336;margin-left:30%;"
            (click)="submitDUeOrder()">
            Submit
          </button>
        </form>
      </div>

    </div>
  </div>
</div>

<div class="modal fade show d-block" tabindex="-1" role="dialog" [ngClass]="{ 'show d-block': showOrderDuePopup }"
  style="  background: rgba(0,0,0,0.5);  /* <-- dim effect */
  z-index: 1040; ">
  <div class="modal-dialog modal-sm  modal-dialog-centered" role="document">
    <div class="modal-content">

      <!-- Header -->
      <div class="modal-header">
        <h5 class="modal-title">Create New Model</h5>
        <button type="button" class="btn-close" (click)="closeOrderDuePopup()"></button>
      </div>

      <!-- Body -->
      <div class="modal-body">
        <form [formGroup]="orderdueForm">

          <!-- Order Type -->
          <div class="mb-3">
            <label class="form-label">Order Due</label>
            <select class="form-select" formControlName="orderDue">
              <option value="ASAP">ASAP</option>
              <option value="Later">Later</option>
            </select>
          </div>
          <div class="mb-3" *ngIf="orderdueForm.get('orderDue')?.value == 'Later'">
            <label class="form-label">Date and Time</label>
            <input type="datetime-local" placeholder="Select date and Time" formControlName="orderDateTime" />
          </div>


        </form>
        <button class="btn fw-bold text-white " style="background: #f44336;margin-left: 30%;"
          (click)="submitDUeOrder()">Submit</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" tabindex="-1" role="dialog"
     [ngClass]="{ 'show d-block': showCustomerModal }"
     style="background: rgba(0,0,0,0.5); z-index: 1050;">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content p-3">

      <!-- Modal Header -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">Customer</h5>
        <button type="button" class="btn-close" (click)="closeCustomerModal()"></button>
      </div>

      <!-- Search / Input Fields -->
      <div class="p-3 border rounded mb-3">
        <div class="row g-3">
          <div class="col-md-12">
            <label class="form-label">Name</label>
            <input type="text" class="form-control" [(ngModel)]="customer.name" placeholder="Enter Name">
          </div>
          <div class="col-md-12">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" [(ngModel)]="customer.email" placeholder="Enter Email">
          </div>
          <div class="col-md-12">
            <label class="form-label">Phone</label>
            <input type="tel" class="form-control" [(ngModel)]="customer.phone" placeholder="Enter Phone">
          </div>
        </div>
      </div>

      
      <!-- OK Button -->
      <!-- <div class="text-center">
          <button class="btn btn-primary w-100" (click)="clear()">
        Clear
        </button>
        <button class="btn btn-primary w-50" (click)="closeCustomerModal()">
          OK
        </button>
      </div> -->
      <div class="d-flex justify-content-end gap-2 mt-3">
  <button class="btn btn-secondary" (click)="clear()">Clear Customer</button>
  <button class="btn btn-primary" (click)="closeCustomerModal()">OK</button>
</div>

    </div>
  </div>
</div>
