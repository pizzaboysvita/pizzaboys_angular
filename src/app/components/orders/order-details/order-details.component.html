<div class="row g-0 unified-card">
  <div class="col-xl-8 left-section p-3">
    <app-media (itemAdded)="addToCart($event)" (popupClosed)="onPopupClosed()">
    </app-media>
  </div>

  <div
    class="col-xl-4 right-section p-0 shadow-sm d-flex flex-column"
    style="height: 90vh; overflow: hidden !important"
  >
    <!-- Order Header -->
    <div class="d-flex justify-content-center" style="column-gap: 10px">
      <h5 class="text-dark mt-2 mb-3 fw-bold">Order List</h5>
      <div class="order-icon-row mb-2 gap-1">
        <i class="ri-shopping-bag-2-line f-16" (click)="orderList()"></i>
      </div>
    </div>

    <!-- Order Type Buttons -->
    <div class="btn-group w-100 mb-3 order-type-toggle">
      <button
        type="button"
        class="toggle-btn"
        [class.active]="selected === 'dinein'"
        (click)="selected = 'dinein'; openNewModelPopup()"
      >
        {{ orderForm.value.orderType }}
      </button>

      <button
        type="button"
        class="toggle-btn"
        [class.active]="selected === 'delivery'"
        (click)="selected = 'delivery'; openDeliveryPopup()"
      >
        {{ orderDueDetails }}
      </button>
    </div>

    <!-- Icons Row -->
    <div class="container-fluid p-0">
      <div class="row g-0 icon-row text-center">
        <div class="col icon-box"><i class="ri-file-line"></i></div>
        <div class="col icon-box" (click)="openCustomerModal()"><i class="ri-user-line"></i></div>
        <div class="col icon-box" ><i class="ri-price-tag-line" (click)="openmodal()"></i></div>
        <div class="col icon-box" (click)="openholdModal()"><i class="ri-hand"></i></div>
        <div class="col icon-box"><i class="ri-shopping-cart-line"></i></div>
      </div>
    </div>

    <!-- Order Items List -->
    <div
      class="p-3"
      style="height: 400px; overflow-y: auto; overflow-x: hidden"
    >
      <ul>
        @for (item of totalCartDetails; track item) {

        <!-- COMBO ITEM -->
        @if (item.dish_type === 'combo') {
        <li class="mb-3">
          <div class="horizontal-product-box">
            <div class="row align-items-start">
              <!-- Image + Quantity -->
              <div class="col-3 text-center">
                <img
                  [src]="item.dish_image"
                  alt="{{ item.dish_name }}"
                  width="70"
                  height="60"
                  class="rounded"
                  style="object-fit: cover"
                />

                <div
                  class="like-box d-flex justify-content-center mt-2"
                  style="width: 70px"
                >
                  <i
                    class="ri-subtract-line"
                    (click)="decreaseModalQuantity(item)"
                    style="cursor: pointer"
                  ></i>
                  <span>{{ item.dish_quantity }}</span>
                  <i
                    class="ri-add-line"
                    (click)="increaseModalQuantity(item)"
                    style="cursor: pointer"
                  ></i>
                  <i
                    class="ri-delete-bin-line text-danger"
                    (click)="removeItem(item)"
                    style="cursor: pointer"
                  ></i>
                </div>
              </div>

              <!-- Combo Info -->
              <div class="col-9">
                <div class="d-flex justify-content-between">
                  <h6 class="mb-0" style="font-size: 14px">
                    <b>{{ item.dish_name }}</b>
                  </h6>
                  <h6 class="mb-0 fw-bold" style="font-size: 14px">
                    ${{ item.item_total_price }}
                  </h6>
                </div>

                <div
                  *ngFor="let comboOpt of item.combo_selected_dishes"
                  class="mt-1"
                >
                  <div style="font-size: 14px">
                    <span style="text-decoration: underline; font-weight: 600">
                      {{ comboOpt.combo_option_name }}
                    </span>
                  </div>

                  <div
                    *ngFor="let option of comboOpt.combo_option_selected_array"
                    class="ms-3"
                  >
                    <div style="font-size: 14px; font-weight: 500">
                      {{ option.dish_opt_type }}
                    </div>

                    <ul
                      class="ms-4 mb-1"
                      style="font-size: 14px; list-style-type: disc"
                    >
                      <li *ngFor="let opt of option.choose_option">
                        {{ opt.name }}
                        <span *ngIf="opt.price"> - ${{ opt.price }}</span>
                      </li>
                    </ul>
                  </div>
                </div>

                <div class="d-flex align-items-center gap-3">
                  <i
                    class="ri-edit-2-line text-primary fs-5"
                    (click)="editItem(item)"
                    style="cursor: pointer"
                  ></i>

                  <i
                    class="ri-delete-bin-line text-danger fs-5"
                    (click)="removeItems(item)"
                    style="cursor: pointer"
                  ></i>
                </div>
              </div>
            </div>
          </div>
        </li>
        }

        <!-- STANDARD ITEM -->
        @else if (item.dish_type === 'standard') {
        <li class="mb-3">
          <div class="horizontal-product-box">
            <div class="row align-items-start">
              <!-- Image + Quantity -->
              <div class="col-3 text-center">
                <img
                  [src]="item.dish_image"
                  alt="{{ item.dish_name }}"
                  width="70"
                  height="60"
                  class="rounded"
                  style="object-fit: cover"
                />

                <div
                  class="like-box d-flex justify-content-center mt-2"
                  style="width: 70px"
                >
                  <i
                    class="ri-subtract-line"
                    (click)="decreaseModalQuantity(item)"
                    style="cursor: pointer"
                  ></i>
                  <span>{{ item.dish_quantity }}</span>
                  <i
                    class="ri-add-line"
                    (click)="increaseModalQuantity(item)"
                    style="cursor: pointer"
                  ></i>
                  <i
                    class="ri-delete-bin-line text-danger"
                    (click)="removeItem(item)"
                    style="cursor: pointer"
                  ></i>
                </div>
              </div>

              <!-- Item Info -->
              <div class="col-9">
                <div class="d-flex justify-content-between">
                  <h6 class="mb-0" style="font-size: 14px">
                    <b>{{ item.dish_name }}</b>
                  </h6>
                  <h6 class="mb-0 fw-bold" style="font-size: 14px">
                    ${{ item.item_total_price }}
                  </h6>
                </div>

                <div
                  *ngFor="let standedOpt of item.standed_option_selected_array"
                  class="mt-1"
                >
                  <div style="font-size: 14px; font-weight: 500">
                    {{ standedOpt.dish_opt_type }}
                  </div>

                  <ul
                    class="ms-4 mb-1"
                    style="font-size: 14px; list-style-type: disc"
                  >
                    <li *ngFor="let opt of standedOpt.choose_option">
                      {{ opt.name }}
                      <span *ngIf="opt.price"> - ${{ opt.price }}</span>
                    </li>
                  </ul>
                </div>

                <div class="d-flex align-items-center gap-3">
                  <i
                    class="ri-edit-2-line text-primary fs-5"
                    (click)="editItem(item)"
                    style="cursor: pointer"
                  ></i>

                  <i
                    class="ri-delete-bin-line text-danger fs-5"
                    (click)="removeItems(item)"
                    style="cursor: pointer"
                  ></i>
                </div>
              </div>
            </div>
          </div>
        </li>
        } }
      </ul>
    </div>

    <!-- Totals -->
    <div class="p-3">
      <div class="d-flex justify-content-between mb-1">
        <span class="text-muted">Subtotal</span>
        <span class="fw-semibold">${{ subtotal.toFixed(2) }}</span>
      </div>

      <div class="d-flex justify-content-between mb-2">
        <span class="text-muted">GST 10%</span>
        <span class="fw-semibold">${{ tax }}</span>
      </div>

      @if(orderForm.value.orderType === 'delivery'){
      <div class="d-flex justify-content-between mb-2">
        <span class="text-muted">Delivery Fee</span>
        <span class="fw-semibold">${{ deliveryfee }}</span>
      </div>
      }

      <div class="d-flex justify-content-between fw-bold mb-3">
        <span>Total</span>
        <span>${{ total.toFixed(2) }}</span>
      </div>

      <button
        class="btn btn-primary w-100 fw-bold"
        style="border-radius: 10px; padding: 12px"
        (click)="submitOrder()"
      >
        Pay ${{ total.toFixed(2) }}
      </button>
    </div>
  </div>
</div>

<!-- Order Type Modal -->
<div
  class="modal fade"
  tabindex="-1"
  role="dialog"
  [ngClass]="{ 'show d-block': showNewModelPopup }"
  style="background: rgba(0, 0, 0, 0.5); z-index: 1040"
>
  <div class="modal-dialog modal-sm modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Order Type</h5>
        <button class="btn-close" (click)="closeNewModelPopup()"></button>
      </div>

      <div class="modal-body">
        <form [formGroup]="orderForm">
          <div class="mb-3">
            <label class="form-label">Order Type</label>
            <select class="form-select" formControlName="orderType">
              <option value="pickup">Pick Up</option>
              <option value="delivery">Delivery</option>
            </select>
          </div>

          <div
            class="mb-3"
            *ngIf="orderForm.get('orderType')?.value === 'delivery'"
          >
            <label class="form-label">Delivery Address</label>
            <input
              type="text"
              #addressInput
              class="form-control"
              placeholder="Search your address"
              (input)="getAddressAutocomplete()"
              formControlName="deliveryAddress"
            />
          </div>

          <div *ngIf="orderForm.get('deliveryAddress')?.value">
            <div class="mb-3">
              <label class="form-label">Street Number</label>
              <input
                type="text"
                class="form-control"
                formControlName="streetNumber"
              />
            </div>

            <div class="mb-3">
              <label class="form-label">Unit Number</label>
              <input
                type="text"
                class="form-control"
                formControlName="unitNumber"
              />
            </div>

            <div class="mb-3">
              <label class="form-label">Delivery Note</label>
              <input
                type="text"
                class="form-control"
                formControlName="deliveryNote"
              />
            </div>
          </div>

          <button
            type="button"
            class="btn fw-bold text-white"
            style="background: #f44336; margin-left: 30%"
            (click)="submitDUeOrder()"
          >
            Submit
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Order Due Modal -->
<div
  class="modal fade"
  tabindex="-1"
  [ngClass]="{ 'show d-block': showOrderDuePopup }"
  style="background: rgba(0, 0, 0, 0.5); z-index: 1040"
>
  <div class="modal-dialog modal-sm modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Create New Model</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeOrderDuePopup()"
        ></button>
      </div>

      <div class="modal-body">
        <form [formGroup]="orderdueForm">
          <div class="mb-3">
            <label class="form-label">Order Due</label>
            <select class="form-select" formControlName="orderDue">
              <option value="ASAP">ASAP</option>
              <option value="Later">Later</option>
            </select>
          </div>

          <div class="mb-3" *ngIf="orderdueForm.value.orderDue == 'Later'">
            <label class="form-label">Date and Time</label>
            <input
              type="datetime-local"
              class="form-control"
              formControlName="orderDateTime"
            />
          </div>
        </form>

        <button
          class="btn fw-bold text-white"
          style="background: #f44336; margin-left: 30%"
          (click)="submitDUeOrder()"
        >
          Submit
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Customer Modal -->
<div
  class="modal fade"
  tabindex="-1"
  [ngClass]="{ 'show d-block': showCustomerModal }"
  style="background: rgba(0, 0, 0, 0.5); z-index: 1050"
>
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content p-3">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">Customer</h5>
        <button class="btn-close" (click)="closeCustomerModal()"></button>
      </div>

      <div class="p-3 border rounded mb-3">
        <div class="row g-3">
          <div class="col-md-12">
            <label class="form-label">Name</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="customer.name"
            />
          </div>

          <div class="col-md-12">
            <label class="form-label">Email</label>
            <input
              type="email"
              class="form-control"
              [(ngModel)]="customer.email"
            />
          </div>

          <div class="col-md-12">
            <label class="form-label">Phone</label>
            <input
              type="tel"
              class="form-control"
              [(ngModel)]="customer.phone"
            />
          </div>
        </div>
      </div>

      <div class="d-flex justify-content-end gap-2 mt-3">
        <button class="btn btn-secondary" (click)="clear()">
          Clear Customer
        </button>
        <button class="btn btn-primary" (click)="closeCustomerModal()">
          OK
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Combo Alert -->
<app-combo-alert
  *ngIf="showComboAlert"
  [message]="comboMessage"
  (yes)="onComboYes()"
  (no)="onComboNo()"
  (closed)="onComboNo()"
>
</app-combo-alert>

<!-- Combo Selection Modal -->
<app-combo-selection
  *ngIf="showComboSelection"
  [combos]="matchingCombos"
  (selected)="onComboSelected($event)"
  (closed)="showComboSelection = false"
>
</app-combo-selection>


<div class="modal fade"
     tabindex="-1"
     role="dialog"
     [ngClass]="{ 'show d-block': Openmodal }"
     style="background: rgba(0,0,0,0.5); z-index: 1040;">

  <div class="modal-dialog modal-dialog-centered hold-modal">
    <div class="modal-content">

      <!-- Title -->
      <!-- <div class="p-3 pb-0">
        <h5 class="fw-bold mb-0">Hold Order</h5>
      </div> -->
  <div class="modal-header">
        <h5 class="modal-title fw-bold">Hold Order</h5>
        <button class="btn-close" (click)="Openmodal=false"><i class="ri-close-line"></i></button>
      </div>

      <!-- Body -->
      <div class="modal-body pt-2">
        <p class="text-muted mb-3 small">
          Stash the order away to be retrieved later
        </p>

        <input
          type="text"
          class="form-control hold-input"
          placeholder="Note"
           />
      </div>

      <!-- Footer -->
       
      <div class="modal-footer justify-content-end border-0 pt-0 pb-3 px-3">
        <button class="btn hold-cancel"  (click)="Openmodal=false">CANCEL</button>
        <!-- <button class="btn hold-proceed" >PROCEED</button> -->
         <button class="btn fw-bold text-white"
                style="background:#f44336;"
                >
          PROCEED
        </button>
      </div>

    </div>
  </div>

</div>
<div class="modal fade"
     tabindex="-1"
     role="dialog"
     [ngClass]="{ 'show d-block': cashCount }"
     (click)="cashCount=false"
     style="background: rgba(0,0,0,0.5); z-index: 1040;">

  <div class="modal-dialog modal-dialog-centered modify-modal"
       (click)="$event.stopPropagation()">

    <div class="modal-content">

      <!-- TITLE -->
      <div class="modal-header border-0 pt-3 pb-2">
        <h5 class="modal-title fw-bold">Modify Price</h5>
        <button class="btn-close" (click)="cashCount=false"></button>
      </div>

      <!-- TABS -->
      <div class="modify-tabs d-flex">
        <button class="tab-btn"
                [class.active]="paymentTab==='specific'"
                (click)="paymentTab='specific'">SPECIFIC</button>

        <button class="tab-btn"
                [class.active]="paymentTab==='discount'"
                (click)="paymentTab='discount'">DISCOUNT</button>

        <button class="tab-btn"
                [class.active]="paymentTab==='surcharge'"
                (click)="paymentTab='surcharge'">SURCHARGE</button>

        <button class="symbol-btn"
                [class.active]="typeTab==='$'"
                (click)="typeTab='$'">$</button>

        <button class="symbol-btn"
                [class.active]="typeTab==='%'"
                (click)="typeTab='%'">%</button>
      </div>

      <!-- DISPLAY VALUE -->
      <div class="modify-display text-end">
        {{ modifyValue }}{{ typeTab }}
      </div>

      <!-- KEYPAD -->
      <div class="modify-grid">
        <button class="grid-btn" *ngFor="let n of ['7','8','9','4','5','6','1','2','3','0','00']"
                (click)="onKey(n)">
          {{ n }}
        </button>
      </div>

      <!-- SUMMARY -->
      <div class="summary-box">
        <div class="row summary-row">
          <div class="col">Base Price</div>
          <div class="col text-end">$0.00</div>
        </div>

        <div class="row summary-row">
          <div class="col">New Price</div>
          <div class="col text-end">$0.00</div>
        </div>

        <div class="row summary-row">
          <div class="col">Surcharge</div>
          <div class="col text-end">$0.00</div>
        </div>
      </div>

      <!-- APPLY BUTTON -->
      <button class="apply-btn w-100">APPLY</button>

    </div>
  </div>
</div>

