<div class="modal" *ngIf="isOpen()">
  <div class="modal-content">
    <button type="button" class="close-button" (click)="closeModal()">✖</button>
    <h2>Create Conditional Fee</h2>

    <form [formGroup]="form" (ngSubmit)="submit()">
      <!-- Fee Name -->
      <div class="form-group">
        <label>Name</label>
        <input type="text" formControlName="fee_name" placeholder="Enter fee name" />
        <small>
          Give this fee a meaningful name. It will be displayed on your customers receipt if it's applied
        </small>
      </div>

      <!-- Fixed Fee -->
      <div class="form-group">
        <label>Fixed Fee</label>
        <div class="input-prefix">
          <span>$</span>
          <input type="number" formControlName="fixed_fee" placeholder="0.00" />
        </div>
        <small>This fixed amount will be added to your customers cart total</small>
      </div>

      <!-- Percent Fee -->
      <div class="form-group">
        <label>Percent Fee</label>
        <div class="input-prefix">
          <span>%</span>
          <input type="number" formControlName="percent_fee" placeholder="0" />
        </div>
        <small>Will add the respective percentage fee based off the customers cart total</small>
      </div>

      <!-- Fee Match Condition -->
      <div class="form-group">
        <label>Fee Match Condition</label>
        <div class="toggle-group">
          <button type="button" [class.active]="form.value.fee_match_condition==='ANY'"
            (click)="form.get('fee_match_condition')?.setValue('ANY')">Any</button>
          <button type="button" [class.active]="form.value.fee_match_condition==='SPECIFIC'"
            (click)="form.get('fee_match_condition')?.setValue('SPECIFIC')">Specific</button>
        </div>
        <small>
          Determines under what conditions the fee will apply.
          <strong>Any:</strong> if one condition is met.
          <strong>Specific:</strong> only if all conditions are met.
        </small>
      </div>

      <!-- Order Times -->
      <div class="form-group">
        <label>Order Times <span class="optional">(OPTIONAL)</span></label>
        <div formArrayName="order_times" class="time-slots">
          <div *ngFor="let group of orderTimes.controls; let i = index" [formGroupName]="i" class="time-slot">
            <select formControlName="day">
              <option value="">Select day</option>
              <option *ngFor="let d of days" [value]="d">{{ d }}</option>
            </select>
            <input type="time" formControlName="start" /> to
            <input type="time" formControlName="end" />
            <button type="button" class="remove" (click)="removeOrderTime(i)">✖</button>
          </div>
        </div>
        <button type="button" class="add-btn" (click)="addOrderTime()">+ Add Order Time</button>
        <small>Select which order times this fee will apply to. Leave empty for all.</small>
      </div>

      <!-- Services -->
      <div class="form-group">
        <label>Services <span class="optional">(OPTIONAL)</span></label>
        <ng-select [items]="serviceOptions" [multiple]="true" formControlName="services"
          placeholder="Select services"></ng-select>
        <small>Select which services this fee will be applicable for. Leave empty for all</small>
      </div>

      <!-- Payments -->
      <div class="form-group">
        <label>Payments <span class="optional">(OPTIONAL)</span></label>
        <ng-select [items]="paymentOptions" [multiple]="true" formControlName="payments"
          placeholder="Select payments"></ng-select>
        <small>Select which payment methods this fee will be applicable for. Leave empty for all</small>
      </div>

      <!-- Applicable Hours -->
      <div class="form-group">
        <label>Applicable Hours <span class="optional">(OPTIONAL)</span></label>
        <div formArrayName="applicable_hours" class="time-slots">
          <div *ngFor="let group of applicableHours.controls; let i = index" [formGroupName]="i" class="time-slot">
            <input type="time" formControlName="start" /> to
            <input type="time" formControlName="end" />
            <button type="button" class="remove" (click)="removeApplicableHour(i)">✖</button>
          </div>
        </div>
        <button type="button" class="add-btn" (click)="addApplicableHour()">+ Add Time Slot</button>
        <small>Leave empty for all hours. Times must not overlap.</small>
      </div>

      <!-- Disable Fee -->
      <div class="form-group toggle">
        <label>
          <input type="checkbox" formControlName="disable_fee" />
          Disable Fee
        </label>
        <small>Disable this fee without deleting it</small>
      </div>

      <!-- Messages -->
      <div class="error-message" *ngIf="errorMessage()">{{ errorMessage() }}</div>
      <div class="success-message" *ngIf="successMessage()">{{ successMessage() }}</div>

      <!-- Save Button -->
      <button type="submit" class="save-btn" [disabled]="loading()">Save</button>
    </form>
  </div>
</div>