<form [formGroup]="deliveryForm" class="card-body">
    <ul class="nav nav-tabs mb-3" id="deliveryTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link active" id="general-tab" data-bs-toggle="tab" href="#delivery-general" role="tab"
                aria-controls="delivery-general" aria-selected="true">General</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="conditions-tab" data-bs-toggle="tab" href="#delivery-conditions" role="tab"
                aria-controls="delivery-conditions" aria-selected="false">Conditions</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="fees-tab" data-bs-toggle="tab" href="#delivery-fees" role="tab"
                aria-controls="delivery-fees" aria-selected="false">Fees</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="zones-tab" data-bs-toggle="tab" href="#delivery-zones" role="tab"
                aria-controls="delivery-zones" aria-selected="false">Zones</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="order-timing-tab" data-bs-toggle="tab" href="#delivery-order-timing" role="tab"
                aria-controls="delivery-order-timing" aria-selected="false">Order Timing</a>
        </li>
    </ul>

    <div class="tab-content">
        <!-- ================= GENERAL TAB ================= -->
        <div class="tab-pane fade show active" id="delivery-general" role="tabpanel" aria-labelledby="general-tab">
            <div class="mb-4">
                <label class="form-check-label fw-bold">Enabled</label>
                <div class="form-check form-switch mt-2">
                    <input class="form-check-input" type="checkbox" role="switch" formControlName="enabled" />
                </div>
            </div>

            <div class="mb-4">
                <label for="prepTime" class="form-label fw-bold">Food Preparation Time (minutes)</label>
                <input type="number" class="form-control" id="prepTime" formControlName="food_prep_time" />
            </div>

            <div class="mb-4">
                <label for="deliveryNotes" class="form-label fw-bold">Delivery Notes</label>
                <textarea class="form-control mt-2" id="deliveryNotes" rows="3"
                    formControlName="delivery_notes"></textarea>
            </div>

            <div class="mb-4">
                <label class="form-check-label fw-bold">Avoid Tolls</label>
                <div class="form-check form-switch mt-2">
                    <input class="form-check-input" type="checkbox" role="switch" formControlName="avoid_tolls" />
                </div>
            </div>

            <div class="mb-4">
                <label class="form-check-label fw-bold">Avoid Highways</label>
                <div class="form-check form-switch mt-2">
                    <input class="form-check-input" type="checkbox" role="switch" formControlName="avoid_highways" />
                </div>
            </div>

            <div class="mb-4">
                <label for="blockAddresses" class="form-label fw-bold">Block Delivery Addresses</label>
                <textarea class="form-control mt-2" id="blockAddresses" rows="3"
                    formControlName="block_addresses"></textarea>
            </div>

            <div class="mb-4">
                <label for="defaultMenu" class="form-label fw-bold">Default Menu</label>
                <select class="form-select mt-2" id="defaultMenu" formControlName="default_menu">
                    <option value="">None</option>
                    <option>Menu 1</option>
                    <option>Menu 2</option>
                </select>
            </div>
        </div>

        <!-- ================= CONDITIONS TAB ================= -->
        <div class="tab-pane fade" id="delivery-conditions" role="tabpanel" aria-labelledby="conditions-tab">
            <div class="mb-4">
                <label for="minOrderAmount" class="form-label fw-bold">Minimum Order Amount ($)</label>
                <input type="number" class="form-control mt-2" id="minOrderAmount" formControlName="min_order_amount" />
            </div>

            <div class="mb-4">
                <label for="maxDeliveryDistance" class="form-label fw-bold">Max Delivery Distance (km)</label>
                <input type="number" class="form-control mt-2" id="maxDeliveryDistance"
                    formControlName="max_delivery_distance" />
            </div>

            <div class="mb-4">
                <label for="maxDrivingTime" class="form-label fw-bold">Max Driving Time (minutes)</label>
                <input type="number" class="form-control mt-2" id="maxDrivingTime" formControlName="max_driving_time" />
            </div>

            <div class="d-grid mt-4">
                <button type="button" class="btn btn-warning btn-lg" (click)="saveDeliveryService()">Save</button>
            </div>
        </div>

        <!-- ================= FEES TAB ================= -->
        <div class="tab-pane fade" id="delivery-fees" role="tabpanel" aria-labelledby="fees-tab">
            <div class="p-3">
                <h6 class="fw-bold mb-3">Fee Type</h6>
                <ul class="nav nav-pills mb-4">
                    <li class="nav-item">
                        <button type="button" class="nav-link" [class.active]="deliveryForm.value.fee_type==='fixed'"
                            (click)="deliveryForm.patchValue({fee_type: 'fixed'})">
                            Fixed
                        </button>
                    </li>
                    <li class="nav-item">
                        <button type="button" class="nav-link" [class.active]="deliveryForm.value.fee_type==='range'"
                            (click)="deliveryForm.patchValue({fee_type: 'range'})">
                            Range
                        </button>
                    </li>
                    <li class="nav-item">
                        <button type="button" class="nav-link" [class.active]="deliveryForm.value.fee_type==='formula'"
                            (click)="deliveryForm.patchValue({fee_type: 'formula'})">
                            Formula
                        </button>
                    </li>
                </ul>

                <!-- Fixed Fee -->
                <div *ngIf="deliveryForm.value.fee_type==='fixed'">
                    <label class="form-label fw-bold">Flat Delivery Fee ($)</label>
                    <input type="number" class="form-control mb-3" formControlName="fixed_fee" />
                </div>

                <!-- Range Fee -->
                <div *ngIf="deliveryForm.value.fee_type==='range'" formArrayName="range_fee">
                    <div *ngFor="let group of rangeFeeArray.controls; let i=index" [formGroupName]="i" class="mb-3">
                        <div class="d-flex gap-2">
                            <div class="flex-fill">
                                <label class="form-label">Min (km)</label>
                                <input type="number" class="form-control" formControlName="min" />
                            </div>
                            <div class="flex-fill">
                                <label class="form-label">Max (km)</label>
                                <input type="number" class="form-control" formControlName="max" />
                            </div>
                            <div class="flex-fill">
                                <label class="form-label">Fee ($)</label>
                                <input type="number" class="form-control" formControlName="fee" />
                            </div>
                            <div class="d-flex align-items-end">
                                <button type="button" class="btn btn-outline-danger" (click)="removeRange(i)">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-outline-secondary mt-2" (click)="addRange()">+ Add
                        Range</button>
                </div>

                <!-- Formula Fee -->
                <div *ngIf="deliveryForm.value.fee_type==='formula'" formGroupName="formula_fee">
                    <label class="form-label fw-bold">Formula Fee</label>
                    <div class="d-flex gap-2">
                        <input type="number" class="form-control" placeholder="Base" formControlName="base" />
                        <input type="number" class="form-control" placeholder="Per Km" formControlName="per_km" />
                    </div>
                </div>

                <hr />

                <div class="mb-4">
                    <label for="freeDelivery" class="form-label fw-bold">Free Delivery Amount ($)</label>
                    <input type="number" id="freeDelivery" class="form-control"
                        formControlName="free_delivery_amount" />
                </div>

                <div class="mb-4">
                    <label class="form-label fw-bold">Restrict Delivery Fee Times</label>
                    <input type="text" class="form-control" formControlName="restrict_fee_times"
                        placeholder="10:00-14:00" />
                </div>

                <div class="d-grid mt-4">
                    <button type="button" class="btn btn-save" (click)="saveDeliveryService()">Save</button>
                </div>
            </div>
        </div>

        <!-- ================= ZONES TAB ================= -->
        <div class="tab-pane fade" id="delivery-zones" role="tabpanel" aria-labelledby="zones-tab">
            <div class="p-3">
                <h6 class="fw-bold mb-3">Upload Delivery Zone File (.kml)</h6>
                <div class="upload-box text-center" (click)="fileInput.click()">
                    <input type="file" #fileInput accept=".kml" class="d-none" (change)="onFileSelected($event)" />
                    <div class="upload-content">
                        <i class="bi bi-upload fs-2 text-muted"></i>
                        <p class="text-muted mb-0">Click to upload</p>
                    </div>
                </div>

                <div class="d-grid mt-4">
                    <button type="button" class="btn btn-save" (click)="saveDeliveryService()">Save</button>
                </div>
            </div>
        </div>

        <!-- ================= ORDER TIMING TAB ================= -->
        <div class="tab-pane fade" id="delivery-order-timing" role="tabpanel" aria-labelledby="order-timing-tab">
            <div class="p-3">
                <div class="mb-4">
                    <label class="form-check-label fw-bold">Enable Immediate Orders</label>
                    <div class="form-check form-switch mt-2">
                        <input class="form-check-input" type="checkbox" formControlName="enable_immediate_orders" />
                    </div>
                </div>

                <div class="mb-4">
                    <label for="firstOrderOffset" class="form-label fw-bold">First Order Offset (minutes)</label>
                    <input type="number" id="firstOrderOffset" class="form-control"
                        formControlName="first_order_offset" />
                </div>

                <div class="mb-4">
                    <label for="lastOrderOffset" class="form-label fw-bold">Last Order Offset (minutes)</label>
                    <input type="number" id="lastOrderOffset" class="form-control"
                        formControlName="last_order_offset" />
                </div>

                <div class="mb-4">
                    <label class="form-check-label fw-bold">Enable Later Orders</label>
                    <div class="form-check form-switch mt-2">
                        <input class="form-check-input" type="checkbox" formControlName="enable_later_orders" />
                    </div>
                </div>

                <div class="mb-4">
                    <label for="maxDaysAhead" class="form-label fw-bold">Maximum Days Ahead</label>
                    <input type="number" id="maxDaysAhead" class="form-control" formControlName="max_days_ahead" />
                </div>

                <div class="mb-4">
                    <label for="timeInterval" class="form-label fw-bold">Time Interval (minutes)</label>
                    <input type="number" id="timeInterval" class="form-control" formControlName="time_interval" />
                </div>

                <div class="mb-4">
                    <label for="orderOffset" class="form-label fw-bold">Order Offset (minutes)</label>
                    <input type="number" id="orderOffset" class="form-control" formControlName="order_offset" />
                </div>

                <div class="d-grid mt-4">
                    <button type="button" class="btn btn-save" (click)="saveDeliveryService()">Save</button>
                </div>
            </div>
        </div>
    </div>
</form>