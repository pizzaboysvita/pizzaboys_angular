<div class="card-body" [formGroup]="pickupForm">
  <ul class="nav nav-tabs mb-3" id="pickupTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <a
        class="nav-link active"
        id="general-tab"
        data-bs-toggle="tab"
        href="#general"
        role="tab"
        aria-controls="general"
        aria-selected="true"
        >General</a
      >
    </li>
    <li class="nav-item" role="presentation">
      <a
        class="nav-link"
        id="order-timing-tab"
        data-bs-toggle="tab"
        href="#order-timing"
        role="tab"
        aria-controls="order-timing"
        aria-selected="false"
        >Order Timing</a
      >
    </li>
  </ul>

  <div class="tab-content">
    <!-- ===== General Tab ===== -->
    <div
      class="tab-pane fade show active"
      id="general"
      role="tabpanel"
      aria-labelledby="general-tab"
    >
      <div class="mb-4">
        <label class="form-check-label fw-bold">Enabled</label>
        <div class="form-check form-switch mt-2">
          <input
            class="form-check-input"
            type="checkbox"
            role="switch"
            formControlName="enabled"
          />
        </div>
        <small class="text-muted d-block"
          >Allow customers to place orders that can be collected at your store
          location</small
        >
      </div>

      <div class="mb-4">
        <label for="prepTime" class="form-label fw-bold"
          >Food Preparation Time (minutes)</label
        >
        <input
          type="number"
          class="form-control"
          id="prepTime"
          formControlName="food_prep_time"
          placeholder="Enter minutes"
        />
        <div
          class="text-danger small"
          *ngIf="hasError('food_prep_time', 'min')"
        >
          Must be greater than 0
        </div>
      </div>

      <!-- ===== Food Preparation Time Periods (FormArray) ===== -->
      <div class="mb-4">
        <div class="d-flex justify-content-between align-items-center">
          <label class="form-label fw-bold"
            >Food Preparation Time Periods</label
          >
          <span class="badge bg-secondary-subtle text-secondary">OPTIONAL</span>
        </div>

        <div formArrayName="food_prep_periods" class="mt-2">
          <table
            class="table table-sm table-bordered bg-light text-center w-75"
          >
            <thead class="bg-white">
              <tr class="p-0">
                <th>Day</th>
                <th>Start Time</th>
                <th>Stop Time</th>
                <th class="text-center" style="width: 60px">24 Hour</th>
                <th>Prep Time (m)</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody class="">
              <tr
                class="bg-white"
                *ngFor="let slot of foodPrepPeriods.controls; let i = index"
                [formGroupName]="i"
              >
                <td>
                  <select
                    class="form-select form-select-sm border-0"
                    formControlName="day"
                  >
                    <option *ngFor="let d of daysOfWeek" [value]="d">
                      {{ d }}
                    </option>
                  </select>
                </td>

                <td>
                  <input
                    type="time"
                    class="form-control form-control-sm border-0"
                    formControlName="from"
                  />
                  <div
                    class="text-danger small"
                    *ngIf="slotHasError(i, 'from', 'required')"
                  >
                    Required
                  </div>
                </td>

                <td>
                  <input
                    type="time"
                    class="form-control form-control-sm border-0"
                    formControlName="to"
                  />
                  <div
                    class="text-danger small"
                    *ngIf="slotHasError(i, 'to', 'required')"
                  >
                    Required
                  </div>
                </td>

                <td
                  class="text-center justify-content-center align-content-center"
                >
                  <input
                    class="border-0"
                    style="width: 20px; height: 20px"
                    type="checkbox"
                    formControlName="is_24_hour"
                  />
                </td>

                <td>
                  <input
                    type="number"
                    class="form-control form-control-sm border-0"
                    formControlName="prep_time"
                    placeholder=""
                  />
                  <div
                    class="text-danger small"
                    *ngIf="slotHasError(i, 'prep_time', 'required')"
                  >
                    Required
                  </div>
                </td>

                <td class="text-center d-flex gap-2 justify-content-center">
                  <i
                    class="ri ri-delete-bin-2-fill fs-6 bg-light p-1 gap-1"
                    (click)="removePrepSlot(i)"
                  ></i>
                  <i
                    class="ri ri-file-copy-2-line fs-6 bg-light p-1 gap-1"
                    (click)="duplicatePrepSlot(i)"
                  ></i>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <button
          type="button"
          class="btn btn1 btn-sm mt-2"
          (click)="addPrepSlot()"
        >
          Add Food Prep Slot
        </button>
        <small class="text-muted d-block mt-1"
          >Will override the default food preparation time if one of these
          periods gets matched</small
        >
      </div>
      <!-- ===== end periods ===== -->

      <div class="mb-4">
        <div class="d-flex justify-content-between align-items-center">
          <label for="pickupNotes" class="form-label fw-bold"
            >Pickup Notes</label
          >
          <span class="badge bg-secondary-subtle text-secondary">OPTIONAL</span>
        </div>
        <textarea
          class="form-control mt-2"
          id="pickupNotes"
          rows="3"
          formControlName="pickup_notes"
        ></textarea>
      </div>

      <div class="mb-4">
        <label for="defaultMenu" class="form-label fw-bold">Default Menu</label>
        <select
          class="form-select mt-2"
          id="defaultMenu"
          formControlName="default_menu"
        >
          <option value="">-- Select Menu --</option>
          <option value="takeaway_menu">Takeaway Menu</option>
          <option value="takeaway_menu_copy">Takeaway Menu - copy</option>
        </select>
      </div>

      <div class="d-grid mt-4">
        <button
          type="button"
          class="btn btn-lg"
          (click)="savePickupService()"
          [disabled]="isSubmitting"
        >
          {{ isSubmitting ? "Saving..." : "Save" }}
        </button>
      </div>
    </div>

    <!-- ===== Order Timing Tab (unchanged) ===== -->
    <div
      class="tab-pane fade"
      id="order-timing"
      role="tabpanel"
      aria-labelledby="order-timing-tab"
    >
      <div class="mb-4">
        <label class="form-check-label fw-bold">Enable Immediate Orders</label>
        <div class="form-check form-switch mt-2">
          <input
            class="form-check-input"
            type="checkbox"
            role="switch"
            formControlName="enable_immediate_orders"
          />
        </div>
        <small class="text-muted"
          >Allows customers to place orders due immediately</small
        >
      </div>

      <div class="mb-4">
        <label class="form-label fw-bold">First Order Offset (minutes)</label>
        <input
          type="number"
          class="form-control"
          formControlName="first_order_offset"
          placeholder="Enter minutes"
        />
      </div>

      <div class="mb-4">
        <label class="form-label fw-bold">Last Order Offset (minutes)</label>
        <input
          type="number"
          class="form-control"
          formControlName="last_order_offset"
          placeholder="Enter minutes"
        />
      </div>

      <hr class="my-4" />

      <div class="mb-4">
        <label class="form-check-label fw-bold">Enable Later Orders</label>
        <div class="form-check form-switch mt-2">
          <input
            class="form-check-input"
            type="checkbox"
            role="switch"
            formControlName="enable_later_orders"
          />
        </div>
        <small class="text-muted"
          >Allows customers to place orders for a later date and time</small
        >
      </div>

      <div class="mb-4">
        <label class="form-label fw-bold">Maximum Days Ahead</label>
        <input
          type="number"
          class="form-control"
          formControlName="max_days_ahead"
          placeholder="Enter days"
        />
      </div>

      <div class="mb-4">
        <label class="form-label fw-bold">Time Interval (minutes)</label>
        <input
          type="number"
          class="form-control"
          formControlName="time_interval"
          placeholder="Enter minutes"
        />
      </div>

      <div class="mb-4">
        <label class="form-label fw-bold">Order Offset (minutes)</label>
        <input
          type="number"
          class="form-control"
          formControlName="order_offset"
          placeholder="Enter minutes"
        />
      </div>

      <div class="d-grid mt-4">
        <button
          type="button"
          class="btn btn-lg"
          (click)="savePickupService()"
          [disabled]="isSubmitting"
        >
          {{ isSubmitting ? "Saving..." : "Save" }}
        </button>
      </div>
    </div>
  </div>
</div>
